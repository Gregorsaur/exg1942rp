local PLUGIN = PLUGIN
PLUGIN.name = "Fix Exploits"
PLUGIN.desc = "Prevents certain exploits."
PLUGIN.author = "Zoephix"

-- prevent players from switching characters
function PLUGIN:CanPlayerUseChar(ply, char)
    if ply:GetNWBool("ulx_frozen") or (ply:getChar() and not ply:Alive()) or char:getData("banned", false) then
        return false
    end
end

-- disallow certain tools
local tools = {
    ["physprop"] = true,
    ["faceposer"] = true
}

function PLUGIN:CanTool(ply, tr, name, tool, button)
    if tools[name] and not ply:IsSuperAdmin() then
        return false
    end
end

-- disallow certain props from being spawned
local props = {
    ["models/props_junk/propane_tank001a.mdl"] = true,
    ["models/hts/ww2ns/props/ger/ger_crate_ammo_44u_a_01.mdl"] = true
}

function PLUGIN:PlayerSpawnedProp(ply, model, entity)
    if props[model] and not ply:IsSuperAdmin() then
        ply:notify("You cannot spawn this prop.")
        entity:Remove()
    end
end

-- disallow command usage when frozen or not alive
nut.command.add("fallover", {
	syntax = "[number time]",
	onRun = function(client, arguments)
        if client:IsFrozen() then return end
        if client:GetNWBool("ulx_frozen") then return end
        if not client:Alive() then return end

		local time = tonumber(arguments[1])

		if (!isnumber(time)) then
			time = 5
		end

		if (time > 0) then
			time = math.Clamp(time, 1, 60)
		else
			time = nil
		end

		if (!IsValid(client.nutRagdoll)) then
			client:setRagdolled(true, time)
		end
	end
})
